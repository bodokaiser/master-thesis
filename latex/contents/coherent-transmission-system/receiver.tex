\section{Receiver}
\FloatBarrier

We introduced the receiver as a component decoding a sequence of complex symbols,
\begin{equation}
	\left\{
		\beta_n
		\in
		\mathbb{C}
		\colon
		n\in I
	\right\}
	,
\end{equation}
from a coherent state $\ket{\beta(t)}$.
Just like the transmitter, we want to keep the receiver software-defined.
\begin{figure}[htb]
	\centering
	\includegraphics{figures/tikz/software-defined-receiver}
	\caption{Block diagram of the receiver's signal processing domains. The analog electrical signals $u(t)$, and optional $v(t)$, are demodulated from the quadratures of the optical coherent state $\ket{\beta(t)}$, and then converted to the digital signals $u[m]$, and optional $v[m]$, from which the \gls{dsp} decodes the symbol sequence $\{\beta_n\in\mathbb{C}\colon n\in I\}$.}\label{fig:software_defined_receiver}
\end{figure}
\Cref{fig:software_defined_receiver} shows the signal processing of a possible software-defined receiver.
The coherent state is transferred from the optical via the analog to the digital.
Unlike the transmitter, we have the option of using only one demodulator for the receiver.

\FloatBarrier
\subsection{Down-conversion}

At the transmitter, we up-converted two real baseband signals to a real passband signal.
As we will see, this is not absolutely necessary for the receiver.

We first consider the simpler case of direct down-conversion as depicted in \Cref{fig:down_conversion_single}.
\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/down-conversion-single}
	\caption{Block diagram of single quadrature down-conversion. The signal $z(t)$ is mixed with the \gls{lo} signal $\cos(\omega_lt+\vartheta)$. The down-converted signal $u(t)$ is obtained by \gls{lp} filtering the output signal of the mixing.}\label{fig:down_conversion_single}
\end{figure}
In direct down-conversion, we mix a real-valued signal,
\begin{equation}
	\begin{split}
		z(t)
		=
		\int_{-\infty}^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		+
		\int_{-\infty}^0\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		\\
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		-
		\int_{\infty}^0\frac{\dd{\omega}}{2\pi}
		z(-\omega)
		e^{-i\omega t}
		\\
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega)
			e^{+i\omega t}
			+
			z(\omega)^*
			e^{-i\omega t}
		\right]
		,
	\end{split}
\end{equation}
with a \gls{lo} signal $\cos(\omega_lt+\vartheta)$.
The mixing produces a high- and low-frequency band
\begin{equation}
	\begin{split}
		z(t)
		\cos(\omega_lt+\vartheta)
		&=
		\Re
		\int_0^\infty\frac{\dd{\omega}}{2\pi}
		\left[
			e^{+i(\omega-\omega_l)t}
			+
			e^{+i(\omega+\omega_l)t}
		\right]
		z(\omega)
		e^{+i\vartheta}
		\\
		&=
		\Re
		\int_0^\infty\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega+\omega_l)
			+
			z(\omega-\omega_l)
		\right]
		e^{+i(\omega t+\vartheta)}
		.
	\end{split}
\end{equation}
However, we suppress the high-frequency band using an ideal \gls{lp} filter with bandwidth $B$,
\begin{equation}
	\begin{split}
		u(t)
		&=
		\Re
		\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega+\omega_l)
			+
			z(\omega-\omega_l)
		\right]
		e^{+i(\omega t+\vartheta)}
		\\
		&\approx
		\Re
		\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
		z(\omega-\omega_l)
		e^{+i(\omega t+\vartheta)}
		.
	\end{split}
	\label{eq:down_conversion_real}
\end{equation}
For $\vartheta=0$, the down-converted signal $v(t)$ is equal to projecting the input signal's complex spectrum $z(\omega)$ onto the real axis.
We loose the information on the imaginary axis with our choice for a particular phase reference of the \gls{lo}.
Hence direct down-conversion only conserves a single quadrature.

To conserve both quadratures, we need to split the input signal into two branches and perform single quadrature down-conversion with two orthogonal phase references of the \gls{lo}, see \Cref{fig:down_conversion_dual}.
\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/down-conversion-dual}
	\caption{Block diagram of dual quadrature down-conversion. The signal $z(t)$ is divided equally into an upper and a lower branch. The upper branch is mixed with the phase shifted $\gls{lo}$ signal $\cos(\omega_ct+\vartheta)$. The lower branch is mixed with \gls{lo} signal $\sin(\omega_ct+\vartheta)$. The mixer outputs are filtered separately by a \gls{lp} yielding the down-converted signals $u(t)$ and $v(t)$.}\label{fig:down_conversion_dual}
\end{figure}
The signal of the upper branch $u(t)$ is equal to our result for the single quadrature down-conversion, \cref{eq:down_conversion_real}.
The signal of the lower branch,
\begin{equation}
	v(t)
	=
	\Im
	\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
	z(\omega+\omega_l)
	e^{+i(\omega t+\vartheta)}
	,
	\label{eq:down_conversion_imag}	
\end{equation}
is simply obtained from \cref{eq:down_conversion_real} by shifting the \gls{lo} phase reference by \SI{90}{\degree}, i.e., $\vartheta\to\vartheta+\pi/2$.
Regardless of the particular value of the \gls{lo} phase reference $\vartheta$, dual quadrature down-conversion recovers the complete information, the real and imaginary part, of the input signal spectrum $z(\omega)$.

We presented the electro-optical receiver setups implementing single and dual quadrature down-conversion in \Cref{fig:coherent_receiver_active} and \Cref{fig:coherent_receiver_passive} in \Cref{ch:qkd}.
Essentially, the electro-optical setups combine the optical signal and \gls{lo} in an optical coupler and perform balanced detection on the coupler outputs for which derived the quantum theory in \Cref{sec:photodetectors}.
From a quantum viewpoint, balanced detection corresponds to a quadrature measurement at a particular frequency represented by the generalized quadrature operator, \cref{eq:quadrature_operator_generalized}.

\subsection{Homo- and heterodyning}

So far, we have not assumed any particular signal for the down-conversion but treated the receiver as a spectrum analyzer.
If we now assume the input signal to be from the coherent state transmitter $\ket{\beta(t)}$, the down-converted signals read
\begin{align}
	u(t)
	&=
	\Re
	\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
	\beta(\omega+\omega_i)
	e^{+i(\omega t+\vartheta)}
	\\
	v(t)
	&=
	\Im
	\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
	\beta(\omega+\omega_i)
	e^{+i(\omega t+\vartheta)}
	,
\end{align}
where we defined the intermediate frequency as the difference between the transmitter and receiver laser frequency
\begin{equation}
	\omega_i
	=
	\omega_c-\omega_l
	<
	B/2
	.
\end{equation}
If the intermediate frequency is zero, $\omega_i=0$, we perform homodyning, otherwise, heterodyning.
Furthermore, we distinguish between single and dual homodyning, depending if we perform single or dual quadrature down-conversion.
If the detector bandwidth is large enough to cover the baseband signal at the intermediate frequency, we can resolve both quadratures with heterodyning and single quadrature down-conversion.
\begin{table}[htb]
  \centering
  \begin{tabular}{lccccc}
    \toprule
    Receiver design & Homodyne (single) & Homodyne (dual) & Heterodyne \\
    \midrule
    Balanced detectors & \num{1} & \num{2} & \num{1} \\
    Quadratures & \num{1} & \num{2} & \num{2} \\
    Intermediate frequency & \multicolumn{2}{c}{$\omega_i=0$} & $\omega_i\neq 0$ \\
    Optical complexity & Low & High & Low \\
    Signal bandwidth & High & High & Low \\
    \gls{lo} synchronization & Frequency and phase & Frequency & Bandwidth \\
    \bottomrule
  \end{tabular}
  \caption{Comparison of receiver implementations according to Ref.~\cite{Brunner2017}: The single quadrature homodyne detection offers low optical complexity and high bandwidth but only resolves one of two quadratures and required frequency and phase synchronization of the \gls{lo}. The dual quadrature homodyne detection resolves both quadratures with high bandwidth but requires two balanced detectors increasing the optical complexity and phase synchronization of the \gls{lo}. The heterodyne detection schemes resolves both quadratures with low complexity and no requirements on \gls{lo} synchronization at the cost of signal bandwidth.}\label{tab:receivers}
\end{table}
\Cref{tab:receivers} summarizes the characteristics between the single and dual homodyne and the heterodyne receiver designs.
A strong advantage of the heterodyne receiver design is that both quadratures can be resolved with a single balanced detector, keeping the optical complexity low.

\FloatBarrier
\subsection{Symbol decoding}

We 

\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/symbol-decoding}
	\caption{foo}
\end{figure}

\begin{figure}[htb]
	\centering
	\includegraphics{figures/pgfplots/rx-frequency}
	\caption{foo}
\end{figure}

\begin{figure}[htb]
	\centering
	\includegraphics{figures/pgfplots/rx-rand-time}
	\caption{foo}
\end{figure}