\section{Receiver}
\FloatBarrier

We introduced the receiver as a component decoding a sequence of complex symbols, $\left\{\beta_n\in\mathbb{C}\colon n\in I\right\}$, from a coherent state $\ket{\beta(t)}$.
As with the transmitter, we want our receiver to be software-defined, meaning that the predominant signal processing is in the digital domain and we need to down-convert the optical signal.
\begin{figure}[htb]
	\centering
	\includegraphics{figures/tikz/software-defined-receiver}
	\caption{Block diagram of the receiver's signal processing domains. The analog electrical signals $v(t)$ and $w(t)$ are demodulated from the quadratures of the optical coherent state $\ket{\beta(t)}$, and then converted to the digital signals $v[m]$ and $w[m]$ from which the \gls{dsp} decodes the symbol sequence $\{\beta_n\in\mathbb{C}\colon n\in I\}$.}\label{fig:software_defined_receiver}
\end{figure}
\Cref{fig:software_defined_receiver} illustrates the signal flow across the different domains inside the receiver.
Unlike the transmitter up-conversion, the receiver's down-conversion leaves us some design freedom.
In particular, it is possible to reduce the hardware complexity significantly by introducing an intermediate frequency, which carries over to the digital domain.

\FloatBarrier
\subsection{Down-conversion}

% outlook down-conversion freedoms

\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/down-conversion-single}
	\caption{Block diagram of single quadrature down-conversion. The signal $z(t)$ is mixed with the \gls{lo} $\sin(\omega_lt+\vartheta)$. The output of the mixing is filtered by a \gls{lp} to produce the down-converted signal $u(t)$.}\label{fig:down_conversion_single}
\end{figure}
The mixing of the real-valued passband signal,
\begin{equation}
	\begin{split}
		z(t)
		=
		\int_{-\infty}^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		+
		\int_{-\infty}^0\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		\\
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		z(\omega)
		e^{+i\omega t}
		-
		\int_{\infty}^0\frac{\dd{\omega}}{2\pi}
		z(-\omega)
		e^{-i\omega t}
		\\
		&=
		\int_0^{+\infty}\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega)
			e^{+i\omega t}
			+
			z(\omega)^*
			e^{-i\omega t}
		\right]
		,
	\end{split}
\end{equation}
with the \gls{lo} signal
\begin{equation}
	\sin(\omega_lt+\vartheta)
	=
	\frac{1}{2i}
	\left[
		e^{+i(\omega_lt+\vartheta)}
		-
		e^{-i(\omega_lt+\vartheta)}
	\right]
\end{equation}
produces a high- and low-frequency band
\begin{equation}
	\begin{split}
		z(t)
		\sin(\omega_lt+\vartheta)
		&=
		\Im
		\int_0^\infty\frac{\dd{\omega}}{2\pi}
		\left[
			e^{+i(\omega-\omega_l)t}
			+
			e^{+i(\omega+\omega_l)t}
		\right]
		z(\omega)
		e^{+i\vartheta}
		\\
		&=
		\Im
		\int_0^\infty\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega+\omega_l)
			+
			z(\omega-\omega_l)
		\right]
		e^{+i\omega t+i\vartheta}
		.
	\end{split}
\end{equation}
The high-frequency band is highly suppressed by the ideal \gls{lp},
\begin{equation}
	\begin{split}
		v(t)
		&=
		\Im
		\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
		\left[
			z(\omega+\omega_l)
			+
			z(\omega-\omega_l)
		\right]
		e^{+i(\omega t+\vartheta)}
		\\
		&\approx
		\Im
		\int_0^{B/2}\frac{\dd{\omega}}{2\pi}
		z(\omega-\omega_l)
		e^{+i(\omega t+\vartheta)}
		,
	\end{split}
	\label{eq:down_conversion_imag}
\end{equation}
wherein $B$ denotes the effective detector bandwidth.

% compare result with derived photocurrent for balanced detection
% problem of only one quadrature ->
% reference to active and passive coherent receiver from QKD chapter

\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/down-conversion-dual}
	\caption{Block diagram of dual quadrature down-conversion. The signal $z(t)$ is divided with equal power among an upper and a lower branch. The upper branch is mixed with the phase shifted $\gls{lo}$ signal $\cos(\omega_ct+\vartheta)$. The lower branch is mixed with \gls{lo} signal $\sin(\omega_ct+\vartheta)$. The mixer outputs are filtered separately by a \gls{lp} yielding the down-converted signals $v(t)$ and $w(t)$.}\label{fig:down_conversion_dual}
\end{figure}
\Cref{fig:down_conversion_dual} shows the block diagram corresponding to down-conversion of both quadratures.
The lower branch is equal to the result of the single quadrature downconversion after accounting for the power loss due to the signal split, i.e.,
\begin{equation}
	u(t)
	=
	\Re
	\int_0^B\frac{\dd{\omega}}{2\pi}
	z(\omega+\omega_l)
	e^{+i(\omega t+\vartheta)}
	\label{eq:down_conversion_real}	
\end{equation}

% alternative: heterodyne receiver with IF and digital down-conversion

\begin{table}[htb]
  \centering
  \begin{tabular}{lccccc}
    \toprule
    Receiver design & Homodyne (single) & Homodyne (dual) & Heterodyne \\
    \midrule
    Balanced detectors & \num{1} & \num{2} & \num{1} \\
    Quadratures & \num{1} & \num{2} & \num{2} \\
    Optical complexity & Low & High & Low \\
    Signal bandwidth & High & High & Low \\
    \gls{lo} synchronization & Frequency and phase & Frequency & Bandwidth \\
    \bottomrule
  \end{tabular}
  \caption{Comparison of receiver implementations according to Ref.~\cite{Brunner2017}: The single quadrature homodyne detection offers low optical complexity and high bandwidth but only resolves one of two quadratures and required frequency and phase synchronization of the \gls{lo}. The dual quadrature homodyne detection resolves both quadratures with high bandwidth but requires two balanced detectors increasing the optical complexity and phase synchronization of the \gls{lo}. The heterodyne detection schemes resolves both quadratures with low complexity and no requirements on \gls{lo} synchronization at the cost of signal bandwidth.}\label{tab:receivers}
\end{table}

% heterodyne receiver generalizes (single) homodyne receiver

\FloatBarrier
\subsection{Symbol decoding}

\begin{figure}[htb]
	\centering
	\includegraphics{figures/circuitikz/symbol-decoding}
	\caption{foo}
\end{figure}

\begin{figure}[htb]
	\centering
	\includegraphics{figures/pgfplots/rx-frequency}
	\caption{foo}
\end{figure}

\begin{figure}[htb]
	\centering
	\includegraphics{figures/pgfplots/rx-rand-time}
	\caption{foo}
\end{figure}