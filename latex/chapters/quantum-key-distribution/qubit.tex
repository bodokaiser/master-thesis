\section{Qubit-based protocols}

Many DV-QKD protocols, e.g., the BB84~\cite{Bennett1984} or six-state protocol~\cite{Bechmann1999}, are qubit-based in that the logical quantum system underlying the key generation is a two-state quantum system.
A qubit state $\ket{\psi}$ is an element of a two-dimensional complex Hilbert space with norm one, i.e., $\abs{\braket{\psi}}^2=1$.
In the qubit basis $\{\ket{0},\ket{1}\}$, a generic qubit state takes the form
\begin{align}
	\ket{\psi}
	=
	c_1\ket{0}
	+
	c_2\ket{1}
	&&
	\text{with}\
	\abs{c_1}^2
	+
	\abs{c_2}^2
	=
	1
	.
\end{align}
The state space equals the surface of a three-dimensional unit sphere.
A useful visualization of qubit states is the Bloch sphere, see \Cref{fig:bloch_sphere}.
\begin{figure}[htb]
	\centering
	\includestandalone{figures/tikz/bloch-sphere}
	\caption{Two-state quantum system in the Bloch sphere representation: A (pure) quantum state  $\ket{\psi}=c_1\ket{0}+c_2\ket{1}$ with $\abs{c_1}^2+\abs{c_2}^2=1$ takes a point on the surface on a unit radius sphere. By convention, the standard basis $\left\{\ket{0},\ket{1}\right\}$ is set to equal the $Z$ Pauli eigenbasis $\left\{\ket{z_+},\ket{z_-}\right\}$. The $Y,Z$ Pauli eigenbasis are both orthogonal to the $Z$ basis.}\label{fig:bloch_sphere}
\end{figure}
The Bloch sphere is embedded in three-dimensional space, and there are three independent bases.
Two antiparallel vectors on the Bloch sphere denote two orthonormal basis elements.
The Pauli algebra representing two-dimensional rotations describes state transitions on the Bloch sphere.
It is convenient to select the three Pauli eigenbasis as an orthogonal basis triplet.
By convention one identifies the $Z$ Pauli eigenbasis with the qubit basis $\left\{\ket{0},\ket{1}\right\}$.
\Cref{tab:qubit_encodings} lists different physical quantum systems  which allow encoding of a qubit.
\begin{table}[htb]
	\centering	
	\begin{tabular}{lcc}
		\toprule
		& \multicolumn{2}{c}{Standard basis} \\
		\cmidrule{2-3}
		Encoding variable & $\ket{0}$ & $\ket{1}$ \\
		\midrule
		Polarization & Horizontal & Vertical \\
		Photon number & Vacuum & Single-photon \\
		Time-bin & Early & Late \\
		Phase-bin & \SI{0}{\deg} & \SI{180}{\deg} \\
		\bottomrule
	\end{tabular}
	\caption{Possible physical systems to encode a qubit. Many of the physical systems have a much higher dimension than the qubit space but can pre reduced to a qubit space by a proper mapping.}\label{tab:qubit_encodings}
\end{table}

For qubit-based \gls{qkd}, Alice and Bob must agree on two (or three) orthogonal bases and a mapping between the basis states and some bit sequence, then
\begin{enumerate}
	\item Alice encodes her bits into the state $\ket{\psi}$ and sends it to Bob.
	\item Bob receives the state $\ket{\psi}$ from Alice and performs a measurement decoding some bits.
\end{enumerate}
If Alice and Bob select the same basis, Bob can accurately decode Alice's key bit from the measurement.
Alice and Bob's probability of choosing the same basis for one transmission is one divided by the number of orthogonal bases Alice and Bob have agreed on, e.g., \SI{50}{\percent} if Alice and Bob agreed to use the $X$ and $Z$ Pauli eigenbasis, also called the \gls{qber}.
In the asymptotic limit of many transmissions, the \gls{qber} should approach the theoretical limit.
Otherwise, an opposing third party, Eve, might have tempered with the transmission.
\Cref{tab:dvqkd_transmission_sequence} displays a possible transmission sequence between Alice and Bob.
\begin{table}[htb]
	\centering
	\begin{tabular}{llccccc}
		\toprule
		& & \multicolumn{5}{c}{Transmission} \\
		\cmidrule{3-7}
		Party & Step & 1 & 2 & 3 & 4 & 5 \\ 
		\midrule
		\multirow{3}{*}{Alice} & Initial key bit & \num{0} & \num{1} & \num{1} & \num{0} & \num{0} \\
		& State basis & $Z$ & $X$ & $X$ & $Z$ & $X$ \\
		& Prepared state & $\ket{z_+}$ & $\ket{x_-}$ & $\ket{x_-}$ & $\ket{z_+}$ & $\ket{x_+}$ \\
		\cmidrule{1-1}
		\multirow{3}{*}{Bob} & Measurement basis & $X$ & $Z$ & $X$ & $Z$ & $Z$ \\
		& Possible outcomes & \num{0},\num{1} & \num{0},\num{1} & \num{1} & \num{0} & \num{0},\num{1} \\
		& Sifted key bit & - & - & 1 & 0 & - \\
		\bottomrule
	\end{tabular}
	\caption{Possible transmission sequence for qubit-based \gls{qkd}: Alice randomly selects an initial key bit \num{0} or \num{1} and a state basis $X$ or $Z$ where $X$ respective $Z$ denote the eigenbasis of the Pauli $\sigma_x$ respective $\sigma_z$ matrix. Alice's initial key bit and selected basis determine the quantum state she prepares and sends to Bob. Bob randomly chooses a measurement basis. Only if Alice's and Bob's basis agree, the key bit is not discarded.}\label{tab:dvqkd_transmission_sequence}
\end{table}
After the transmission sequence, Alice and Bob hold a partially correlated and partially secret bit string from which they can distill a shared secret bit string using classical post-processing.

\FloatBarrier
\subsection{Polarization-encoding}

In polarization-encoding qubit-based \gls{qkd} protocols, the polarization of light is used as physical quantum system to encode the logical qubit system.
Classically, the Jones formalism is used to describe polarization states and transformations~\cite[p.~199]{Saleh2007}.
Let $\ket{\leftrightarrow}$ and $\ket{\updownarrow}$ denote the horizontal respective vertical polarization states forming the rectilinear basis.
Let $\ket{\nwsearrow}$ and $\ket{\neswarrow}$ denote the left- and right-diagonal polarization states forming the diagonal basis.
Let $\ket{\circlearrowleft}$ and $\ket{\circlearrowright}$ denote the left- and right-circular polarization states forming the circular basis.
We can express the diagonal and circular basis elements in terms of the rectilinear basis elements:
\begin{align}
	\ket{\nwsearrow}
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{\leftrightarrow}
		+
		\ket{\updownarrow}
	\right)
	&
	\ket{\neswarrow}
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{\leftrightarrow}
		-
		\ket{\updownarrow}
	\right)
	\\
	\ket{\circlearrowleft}
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{\leftrightarrow}
		+
		i\ket{\updownarrow}
	\right)
	&
	\ket{\circlearrowright}
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{\leftrightarrow}
		-
		i\ket{\updownarrow}
	\right)
\end{align}
For clarity, we restrict the following discussion to qubit-based \gls{qkd} protocols where two orthogonal bases are used, e.g., BB84, instead of three orthogonal bases, e.g., six-state protocol.
A possible optical setup to implement such polarization-encoding is depicted in \Cref{fig:polarization_encoding_single}.
\begin{figure}[htb]
	\centering
	\includestandalone{figures/pstricks/qubit-polarization-active}
	\caption{Possible optical setup for polarization-encoding BB84 with active basis selection at the receiver: Alice configures her linear polarizer for horizontal, vertical, left-, or right-diagonal polarization. Bob configures his polarizer for horizontal or left-diagonal polarization and uses a polarized beam splitter to }\label{fig:polarization_encoding_active}
\end{figure}
Alice can prepare the $X$ and $Z$ Pauli eigenbasis states by selecting $\theta=0,\pi,\pi/2,3\pi/2$ which we can compactly write
\begin{equation}
	\ket{\theta}
	=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{y_+}
		+
		e^{i\theta}
		\ket{y_-}
	\right)
	.
\end{equation}
Bob's retarder 
\begin{figure}[htb]
	\centering
	\includestandalone{figures/pstricks/qubit-polarization-passive}
	\caption{Foo.}
\end{figure}

\FloatBarrier
\subsection{Time-phase-encoding}

In the following, we discuss the practical time-phase-encoding BB84 protocol and show its equivalence to the polarization-encoding BB84.
The idea of using phase-encoding was first proposed as part of the BB92 protocol~\cite{Bennett1992}.
The basic setup is illustrated in \Cref{fig:qubit_time_phase_active} and comprises a single-photon source and a first \gls{mzi} on Alice's side as well as a second \gls{mzi} and two single-photon detectors on Bob's side.
\begin{figure}[htb]
	\centering
	\includestandalone{figures/pstricks/qubit-time-phase-active}
	\caption{Fiber-optical setup of the phase-encoding BB84 DV-QKD protocol: Alice creates an entangled photon state using a first \gls{mzi} with phase $\theta=0,\pi/2,\pi,3\pi/2$ and sends it to Bob. Bob detects the photon state using a second \gls{mzi} with phase $\phi=0,\pi$ and two single-photon detectors monitoring the outputs.}\label{fig:qubit_time_phase_active}
\end{figure}

To understand the time-phase encoding, we analyze the action of the (asymmetric) \gls{mzi} with variable phase $\varphi$ on a photon pulse $\ket{t_0}$ arriving at time $t_0$, see \Cref{fig:mzi_asymmetric}.
\begin{figure}[htb]
    \centering
    \includegraphics{figures/pstricks/mzi-asymmetric}
     \caption{Asymmetric \gls{mzi} adding a constant time delay and variable phase difference between the upper and lower path: A pulsed state enters the first beam splitter BS1 to the left and is split among a longer upper path and a shorter lower path. A first mirror M1 directs the pulse from the upper path to a phase shifter which adds a relative phase of $\varphi$ between the upper and lower path. A second mirror M2 directs the pulse from the phase shifter to a second beam splitter BS2 while the lower path is between BS1 and BS2.}\label{fig:mzi_asymmetric}
\end{figure}
An ideal (lossless) and symmetric beam splitter transforms the single-photon input states into a superposition according to\footnote{See Ref.~\cite[p.~137]{Haroche2006} and Ref.~\cite[p.~143]{Gerry2005}}
\begin{align}
	\hat{U}_\text{BS}
	\ket{1,0}
	&=
	\frac{1}{\sqrt{2}}
	\left(\ket{1,0}+i\ket{0,1}\right)
	\\
	\hat{U}_\text{BS}
	\ket{0,1}
	&=
	\frac{1}{\sqrt{2}}
	\left(i\ket{1,0}+\ket{0,1}\right)
	.
\end{align}
Then, the first beam splitter BS1 in \Cref{fig:mzi_asymmetric} (instantly) splits a photon pulse $\ket{t_0}$ arriving at $t_0$ into the superposition
\begin{equation}
	\hat{U}_\text{BS}
	\ket{t_0,0}
	=
	\frac{1}{\sqrt{2}}
	\left(\ket{t_0,0}+i\ket{0,t_0}\right)
\end{equation}
where the first mode corresponds to the upper and the second mode to the lower optical path in \Cref{fig:mzi_asymmetric}.
The phase shifter adds a relative phase of $\varphi$ between the upper and lower path and the input state to the second beam splitter BS2 is
\begin{equation}
	\hat{U}_\text{PS}
	\hat{U}_\text{BS}
	\ket{t_0,0}
	=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{t_0+\tau,0}
		+
		ie^{i\varphi}
		\ket{0,t_0+\tau+\Delta\tau}
	\right)
\end{equation}
wherein $\tau$ is the time delay the pulse accumulates over the short upper path and $\Delta\tau$ is the difference in time delay between the shorter, upper and longer, lower path.
The output state of BS2 is equal to the action of the \gls{mzi}
\begin{equation}
	\begin{split}
		\hat{U}_\text{MZM}
		\ket{t_0,0}
		&=
		\hat{U}_\text{BS}
		\hat{U}_\text{PS}
		\hat{U}_\text{BS}
		\ket{t_0,0}
		\\
		&=
		\frac{1}{2}
		\biggl[
			\left(
				\ket{t_0+\tau,0}
				+
				i\ket{0,t_0+\tau}
			\right)
			+
			ie^{i\varphi}
			\left(
				i\ket{t_0+\tau+\Delta\tau,0}
				+
				\ket{0,t_0+\tau+\Delta\tau}
			\right)
		\biggr]
		\\
		&=
		\frac{1}{2}
		\biggl[
			\ket{t_0+\tau,0}
			-
			e^{i\varphi}
			\ket{t_0+\tau+\Delta\tau,0}
			+
			i
			\left(
				\ket{0,t_0+\tau}
				+
				e^{i\varphi}
				\ket{0,t_0+\tau+\Delta\tau}
			\right)
		\biggr]
		.
	\end{split}
	\label{eq:mzi_asymmetric}
\end{equation}

Back to the time-phase-encoding BB84 setup depicted in \Cref{fig:qubit_time_phase_active}, we note that Alice's transmitter consists of a single-photon source and an asymmetric \gls{mzi} where on output is dumped.
Therefore, Alice's states are parametrized by the relative phase $\theta$,
\begin{equation}
	\ket{t_0,\theta}
	=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{t_0}
		-
		e^{i\theta}
		\ket{t_0+\Delta\tau}
	\right)
	,
\end{equation}
which is obtained from \cref{eq:mzi_asymmetric} by absorbing the time delay of the shorter path $\tau$ into the time reference $t_0$ and projecting the first output mode of the \gls{mzi}.
By adding a time delay to the states of $\Delta\tau$, we receive the states for the time-delayed signal
\begin{align}
	\ket{t_1,\phi}_1
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{t_1}
		-
		e^{i\phi}
		\ket{t_1+\Delta\tau}
	\right)
	\\
	\ket{t_1,\phi}_2
	&=
	\frac{i}{\sqrt{2}}
	\left(
		\ket{t_1}
		+
		e^{i\phi}
		\ket{t_1+\Delta\tau}
	\right)
	\label{eq:qubit_time_phase_bob_nodelay}
\end{align}
where we again choose the time $t_1$ such that it cancels the time delay of the short path $\tau$.
If Bob receives a pulse with time delay $\Delta\tau$ at some time $t_1$, i.e., $\ket{t_1+\Delta\tau}$, then his \gls{mzi} provides the two detectors with the states
\begin{align}
	\ket{t_1+\Delta\tau,\phi}_1
	&=
	\frac{1}{\sqrt{2}}
	\left(
		\ket{t_1+\Delta\tau}
		-
		e^{i\phi}
		\ket{t_1+2\Delta\tau}
	\right)
	\\
	\ket{t_1+\Delta\tau,\phi}_2
	&=
	\frac{i}{\sqrt{2}}
	\left(
		\ket{t_1+\Delta\tau}
		+
		e^{i\phi}
		\ket{t_1+2\Delta\tau}
	\right)
	.
	\label{eq:qubit_time_phase_bob_nodelay}
\end{align}
We note that these are superpositions of states at three different time instances $0,\Delta\tau,2\Delta\tau$.
Alice's state is a superposition of \cref{eq:qubit_time_phase_bob_nodelay} and \cref{eq:qubit_time_phase_bob_delay}, so Bob's detectors will receive the states
\begin{align}
	\ket{\theta,\phi}_1
	&=
	\frac{1}{2}
	\left[
		\ket{\Delta\tau=0}
		-
		\left(
			e^{i\phi}
			+
			e^{i\theta}
		\right)
		\ket{\Delta\tau=1}
		+
		e^{i(\phi+\theta)}
		\ket{\Delta\tau=2}
	\right]
	\\
	\ket{\theta,\phi}_2
	&=
	\frac{i}{2}
	\left[
		\ket{\Delta\tau=0}
		+
		\left(
			e^{i\phi}
			-
			e^{i\theta}
		\right)
		\ket{\Delta\tau=1}
		-
		e^{i(\phi+\theta)}
		\ket{\Delta\tau=2}
	\right]
	\label{eq:qubit_time_phase_bob}
\end{align}
where we dropped the pulse time.
The no time delay and twice time delay states, $\ket{\Delta\tau=0}$ respective $\ket{\Delta\tau=2}$ occur with constant probability $1/4$ and thereby provide no information about the received state.
However, the superposition of one time delay states $\ket{\Delta\tau=1}$ have probability amplitudes $(e^{i\phi}\pm e^{i\theta})/2$.
We define the projector
\begin{equation}
	\hat{P}_{\Delta\tau=1}
	=
	\ketbra{\Delta\tau=1}
\end{equation}
and find the probability for a click at $\Delta\tau=1$ to be
\begin{align}
	p_1
	&=
	\trace{\hat\rho_1\hat{P}_{\Delta\tau=1}}
	=
	\frac{1}{2}
	\left(1+\cos(\theta-\phi)\right)
	\\
	p_2
	&=
	\trace{\hat\rho_2\hat{P}_{\Delta\tau=1}}
	=
	\frac{1}{2}
	\left(1-\cos(\theta-\phi)\right)
\end{align}
where we used the density matrices $\hat\rho_i={}_i\ketbra{\theta,\phi}_i$.
Restricting Alice's possible phases to $\theta=0,\pi,\pi/2,3\pi/2$ and Bob's possible phases to $0,\pi/2$, we find the click probabilities of the detectors as presented in \Cref{tab:qubit_time_phase_clicks}.
\begin{table}[htb]
	\centering
	\begin{tabular}{cccc}
		\toprule
		\multicolumn{2}{c}{Phase} & \multicolumn{2}{c}{Detector click probability} \\
		\cmidrule{1-2}
		\cmidrule{3-4}
		$\theta$ & $\phi$ & $p_1(\theta-\phi)$ & $p_2(\theta-\phi)$ \\
		\midrule
		\multirow{2}{*}{$0$} & $0$ & \SI{100}{\percent} & \SI{0}{\percent} \\
		& $\pi/2$ & \SI{50}{\percent} & \SI{50}{\percent} \\
		\cmidrule{1-2}
		\multirow{2}{*}{$\pi$} & $0$ & \SI{0}{\percent} & \SI{100}{\percent} \\
		& $\pi/2$ & \SI{50}{\percent} & \SI{50}{\percent} \\
		\cmidrule{1-2}
		\multirow{2}{*}{$\pi/2$} & $0$ & \SI{50}{\percent} & \SI{50}{\percent} \\
		& $\pi/2$ & \SI{100}{\percent} & \SI{0}{\percent} \\
		\cmidrule{1-2}
		\multirow{2}{*}{$3\pi/2$} & $0$ & \SI{50}{\percent} & \SI{50}{\percent} \\
		& $\pi/2$ & \SI{0}{\percent} & \SI{100}{\percent} \\
		\bottomrule
	\end{tabular}
	\caption{Foobar}\label{tab:qubit_time_phase_clicks}
\end{table}