\section{Optical splitters and couplers}

Optical splitters and couplers are essential for many sophisticated experiments and devices ranging from classical interferometers to experimental realization of quantum NOT gates~\cite{Adami1998}.
An optical coupler superimposes (mixes) two optical fields, an optical splitter divides an input's power among two outputs.
From a physical perspective, the distinction between splitters and couplers is somewhat artificial, and a description using two inputs and two outputs turns out to be strictly necessary.

The present section starts with a discussion of the classical free-ray beam splitter. Employing energy conservation between the complex in- and output field modes leads to a unitary transformation that can be easily extended to the quantum regime as done in the standard quantum optics literature~\cite{Leonhardt2010,Gerry2005,Loudon2000}.
A different approach closely related to network analysis in electrical engineering defines the optical coupler as a linear passive optical four-port and requires no further assumptions.
The measurement of the scattering parameters can fully characterize the linear passive optical four-port.
Finally, using mode-coupling theory~\cite[p.~359]{Luks2009}, we present a more natural quantum model specific to the waveguide coupler.
We close the section with general input-output relations for coherent states to discuss the limiting cases, e.g., the optical splitter.

\subsection{Classical free-ray beam splitters}

The most commonly employed (free-ray) designs of the beam splitter are the cubic, plate, and pellicle beam splitters depicted in \Cref{fig:beam_splitter_types}.
The cubic beam splitter is made of two triangular prisms.
The interface between the two prisms is finished with a dielectric coating.
The outward-facing surface of the prisms is grafted with an \gls{ar} coating.
Compared to the plate and pellicle beam splitter, the cubic beam splitter has the highest loss and aberrations.
Nonetheless, the cubic beam splitter is a popular choice because of its simple integration into an optical setup.
The pellicle beam splitter consists of a few micrometer thin membrane, optionally with a one-sided coating.
The small thickness of the membrane makes the pellicle beam splitter the most performant in terms of absorption and aberrations among the three designs.
Furthermore, the pellicle embodiment of the beam splitter supports a broad wavelength range.
The drawback of using a pellicle beam splitter is that they are highly susceptible to acoustic noise and require a precise angle to the incident beam.
The plate beam splitter is like a thick pellicle beam splitter made of glass.
Compared to the cubic and pellicle beam splitter's performance, the plate beam splitter is in-between concerning absorption, aberrations, and wavelength range.
\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/beam-splitter-types}
    \caption{Cubic (a), plate (b), and pellicle (c) beam splitter.}\label{fig:beam_splitter_types}
\end{figure}
Given two input beams, represented by the electrical field components $E_1(t)$ and $E_2(t)$, a beam splitter gives rise to two output beams, represented by the electrical field components $E_1^\prime(t)$ and $E_2^\prime(t)$.
\Cref{fig:beam_splitter_cube_plate} illustrates how the input and output fields emerge in the cubic and plate beam splitter.
The two input fields $E_1(t),E_2(t)$ are incident to the cubic and plate beam splitter's left and top, while the two output electric fields $E_1^\prime(t),E_2^\prime(t)$ exit the beam splitter at the right and bottom.
\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/beam-splitter-cubic-plate}
    \caption{Cubic (left) and plate beam splitter (right) with two input beams represented by the electrical field components $E_1(t),E_2(t)$ and two output beam represented by the electrical field components $E_1^\prime(t),E_2^\prime(t)$.}\label{fig:beam_splitter_cube_plate}
\end{figure}

Inside the beam splitter the electric field $\vb{E}(t,\vb{x})$ satisfies the inhomogeneous wave equation
\begin{equation}
	\laplacian\vb{E}(t,\vb{x})
	-
	\mu\pdv[2]{t}\vb{E}(t,\vb{x})
	=
	\mu\pdv[2]{t}\vb{P}(t,\vb{x})
\end{equation}
where $\mu$ is the magnetic permeability and $\vb{P}(t,\vb{x})$ is the macroscopic polarization~\cite[p.~86]{Murti2014}.
In frequency space, the components of the macroscopic polarization are~\cite[p.~1070]{Mandel1995}
\begin{equation}
	P_i(\omega)
	=
	\chi^{(1)}_{ij}(\omega)E^j(\omega)
	+
	\chi^{(2)}_{ijk}(\omega,\omega^\prime)E^j(\omega)E^k(\omega^\prime)
	+
	\dots
\end{equation}
where $\chi^{(n)}$ denotes the $n$th-order of the electric susceptibility tensor.
For a useful beam splitter, we want the electric susceptibility to be linear in frequency space suggesting the Fourier amplitudes of the in- and output fields to relate via
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
    \end{pmatrix}
    =
    \begin{pmatrix}
        t(\omega) & r^\prime(\omega)
        \\
        r(\omega) & t^\prime(\omega)
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(\omega)
        \\
        \mathcal{E}_2(\omega)
    \end{pmatrix}
    \label{eq:beam_splitter_transform}
\end{equation}
wherein $r(\omega),r^\prime(\omega)$ and $t(\omega),t^\prime(\omega)$ are complex coefficients.
Setting either one of the input Fourier amplitudes, $\mathcal{E}_1(\omega)$ or $\mathcal{E}_2(\omega)$, to zero and reviewing \Cref{fig:beam_splitter_cube_plate}, suggests $r(\omega),r^\prime(\omega)$ and $t(\omega),t^\prime(\omega)$ to quantify the reflection respective transmission properties of the beam splitter.
The absolute value of the transmission $\abs{t(\omega)},\abs{t^\prime(\omega)}$ and reflection coefficients $\abs{r(\omega)},\abs{r^\prime(\omega)}$ determine the splitting ratio of the input power among the outputs.
The complex phase factor of the reflection and transmission coefficients characterize the phase shifts with which the input fields contribute to the output fields.

The beam splitter including the in- and output fields constitute an isolated system.
Ignoring thermal energy exchange between the electric fields and the beam splitter medium, the sum of the field energies before and after the interaction need to be conserved, i.e.,
\begin{equation}
    \abs{\mathcal{E}_1^\prime(\omega)}^2
    +
    \abs{\mathcal{E}_2^\prime(\omega)}^2
    =
    \abs{\mathcal{E}_1(\omega)}^2
    +
    \abs{\mathcal{E}_2(\omega)}^2
    \label{eq:beam_splitter_energy_conservation}
    .
\end{equation}
Inserting \cref{eq:beam_splitter_transform} into \cref{eq:beam_splitter_energy_conservation} and setting the one of the input fields to zero, constraints the coefficients by
\begin{align}
    \abs{r(\omega)}^2+\abs{t(\omega)}^2
    =
    1,
    &&
    \abs{r^\prime(\omega)}^2+\abs{t^\prime(\omega)}^2
    =
    1
    \label{eq:beam_splitter_coefficients_constraint}
    .
\end{align}
Theorists often claim the transformation in \cref{eq:beam_splitter_transform} to be symmetric (or reciprocal) due to Maxwell's equations~\cite[p.~129]{Haroche2006}.
However, according Ref.~\cite{Potton2004} only optical system with a single dielectric layer are reciprocal but most physical beam splitters comprise multiple dielectric layers.\footnote{For example, cubic beam splitters have a coating followed by optical cement between the prisms breaking reciprocal symmetry of the system.}

Using classical wave optics and perfect knowledge of the dimensions and material properties, it is possible to derive exact expressions of the complex reflection $r(\omega),r^\prime(\omega)$ and transmission coefficients $t(\omega),t^\prime(\omega)$.
For example, HÃ©nault~\cite{Henault2015} derived an exact expression for the reflected and transmitted amplitudes of a plate beam splitter with one input and a single dielectric layer.
Likewise, Hamilton~\cite{Hamilton2000} discusses the cubic beam splitter with two inputs and different coatings.
In general, the complex reflection and transmission coefficients need to account for multiple reflections at different dielectric layers inside the beam splitter.

\FloatBarrier
\subsection{Unitary beam splitter transform}

Assuming an ideal beam splitter, i.e., a linear lossless optical device with two in- and two output fields, we notice that energy conservation \cref{eq:beam_splitter_energy_conservation} corresponds to an inner product which is automatically preserved if \cref{eq:beam_splitter_transform} is unitary.
A particular useful parametrization of the unitary transformation is introduced by Leonhardt~\cite[p.~92]{Leonhardt2010}
\begin{equation}
	U
	=
    e^{i\Lambda(\omega)}
    \begin{pmatrix}
        e^{+i\Phi(\omega)} & 0
        \\
        0 & e^{-i\Phi(\omega)}
    \end{pmatrix}
    \begin{pmatrix}
        \cos\Theta(\omega) & \sin\Theta(\omega)
        \\
        -\sin\Theta(\omega) & \cos\Theta(\omega)
    \end{pmatrix}
    \begin{pmatrix}
        e^{+i\Psi(\omega)} & 0
        \\
        0 & e^{-i\Psi(\omega)}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform}
\end{equation}
with frequency-dependent angles $\Lambda(\omega),\Theta(\omega),\Psi(\omega),\Phi(\omega)\in\mathbb{R}$.
An alternative parametrization involving Pauli matrices is discussed, for instance, in Ref.~\cite{Zeilinger1981}.
The parametrization of \cref{eq:beam_splitter_unitary_transform} allows for a physical interpretation without assumptions of a macroscopic model.
More precisely, the matrix product in \cref{eq:beam_splitter_unitary_transform} reads as the composition of a phase transform of $\pm\Psi(\omega)$ applied to the input fields, a mixing of the input fields with angle $\Theta(\omega)$, and a phase transform of $\pm\Phi(\omega)$ applied to the mixed fields, in addition, the output fields pick up a global phase $\Lambda(\omega)$ from the optical path length common to the beams.
If the beam splitter is part of a subsystem, then the global phase $\Lambda(\omega)$ becomes local, thereby measurable, and cannot be neglected.

Carrying out the matrix multiplication in \cref{eq:beam_splitter_unitary_transform}, we find
\begin{equation}
	U
	=
    e^{i\Lambda(\omega)}
    \begin{pmatrix}
        e^{+i\psi(\omega)/2}\cos\Theta(\omega) & e^{i\phi(\omega)/2}\sin\Theta(\omega)
        \\
        e^{-i\phi(\omega)/2+i\pi}\sin\Theta(\omega) & e^{-i\psi(\omega)/2}\cos\Theta(\omega)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_expanded}
\end{equation}
where we introduced $\phi(\omega)=(\Phi(\omega)+\Psi(\omega))/2,\psi(\omega)=(\Phi(\omega)-\Psi(\omega))/2$.
For $\Theta(\omega)=0$ and $\Theta(\omega)=\pi/2$ there is no mixing, yet, there is a subtle difference between these cases.
In the case of $\Theta(\omega)=0$, the output fields relate to the input fields via
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
    \end{pmatrix}
    =
    e^{i\Lambda(\omega)}
    \begin{pmatrix}
        \mathcal{E}_1(\omega)e^{+i\psi(\omega)/2}
        \\
        \mathcal{E}_2(\omega)e^{-i\psi(\omega)/2}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_transmission},
\end{equation}
in other words, an additional phase difference of $\psi(\omega)$ is added between the output fields.
In the case of $\Theta(\omega)=\pi/2$, \cref{eq:beam_splitter_unitary_transform_expanded} becomes
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
	\end{pmatrix}
    =
    e^{i\Lambda(\omega)}
    \begin{pmatrix}
        \mathcal{E}_2(\omega)e^{+i\phi(\omega)/2}
        \\
        \mathcal{E}_1(\omega)e^{-i\phi(\omega)/2+i\pi}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_reflection},
\end{equation}
and a phase difference of $\pi(\omega)-\phi(\omega)$ is added between the output fields.
The difference between these two phase shifts between the output fields yields $\phi(\omega)+\psi(\omega)=\pi$.
If we identify $\Theta(\omega)=0$ with the transmitted and $\Theta(\omega)=\pi/2$ with the reflected field\footnote{Only the physical models have a notion of reflectance and transmittance. For the unitary transformation there is no fundamental difference between $\Theta(\omega)=0,\pi/2$ as the $\pi$ phase can be moved around by reparamtrization.}, we recover the statement~\cite{Zeilinger1981} that the phase shift between the transmitted and reflected fields of an ideal beam splitter adds up to $\pi$.\footnote{The statement should not be confused with the statement that the phase difference between the output fields are phase-shifted by $\pi$.}

Evidently, the phases $\psi(\omega),\phi(\omega)$ are a source of confusion and require a thorough examination.
For simplicity, we assume a balanced lossless beam splitter which distributes the input power equally among the outputs.
The corresponding transformation is obtained by setting $\Theta(\omega)=\pi/4$ in \cref{eq:beam_splitter_unitary_transform}
\begin{equation}
	U_{50:50}
	=
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        e^{i\phi(\omega)} & e^{i\psi(\omega)}
        \\
        -e^{-i\psi(\omega)} & e^{-i\phi(\omega)}
    \end{pmatrix}
    e^{i\Lambda(\omega)}
    \label{eq:beam_splitter_unitary_transform_balanced}
    .
\end{equation}
\Cref{eq:beam_splitter_unitary_transform_balanced} cannot be simplified without further assumptions.
In principle, the dimensions, materials and coatings of a physical beam splitter can be tailored for specific $\psi(\omega),\phi(\omega),\Lambda(\omega)$.
\begin{align}
	U_{50:50}^\text{qo}
	=
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & i\\
        i & 1
    \end{pmatrix}
    &&
	U_{50:50}^\text{qc}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & -1\\
        1 & 1
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced_qoqc},
\end{align}
We frequently find the claim in the quantum optics literature, for instance, Ref.~\cite[p.~138]{Gerry2005} that $U_{50:50}^\text{qo}$ describes an ideal balanced beam splitter.
In contrast, the quantum communication literature, for example, Ref.~\cite{Shapiro2009}, postulates $U_{50:50}^\text{qc}$ as the transformation of an ideal balanced beam splitter.\footnote{$U_{50:50}^\text{qc}$ let us write the compact expression $\mathcal{E}_\pm(\omega)=\left(\mathcal{E}_1(\omega)\pm\mathcal{E}_2(\omega)\right)/\sqrt{2}$ for the output fields.} 
While $U_{50:50}^\text{qo}$ corresponds to $\Lambda(\omega)=0,\psi(\omega)=0,\phi(\omega)=\pi/2$ in \cref{eq:beam_splitter_unitary_transform_balanced}, and $U_{50:50}^\text{qc}$ can be obtained with $\Lambda(\omega)=0,\phi(\omega)=0,\psi(\omega)=\pi$, we rarely find a justification to remove three physical \gls{dof}.
If we assume an ideal beam splitter's global phase to be truly global and the other phases to be symmetric with respect to the input fields, it is possible to derive $U_{50:50}^\text{qo}$ from \cref{eq:beam_splitter_unitary_transform_balanced}.
The first assumption lets us remove two \gls{dof}:
First, $\Lambda(\omega)$ is a global phase that cannot be measured, and we are free to choose $\Lambda(\omega)$ as convenient.
Second, we are allowed to choose a common phase origin.
Let us explicitly write $\mathcal{E}_1(\omega)e^{i\delta_1}$ and $\mathcal{E}_2(\omega)e^{i\delta_2}$.
By adjusting the global phase $\Lambda(\omega)$ accordingly, this is equivalent to $\mathcal{E}_1(\omega)e^{i\Delta\delta}$ and $\mathcal{E}_2(\omega)$ wherein $\Delta\delta=\delta_1-\delta_2$, and we can rewrite \cref{eq:beam_splitter_unitary_transform_balanced} together with the field amplitudes as
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        e^{i(\phi(\omega)/2+\Delta\delta)} & e^{i\psi(\omega)/2}
        \\
        -e^{-i(\psi(\omega)/2-\Delta\delta)} & e^{-i\phi(\omega)/2}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(\omega)
        \\
        \mathcal{E}_2(\omega)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced_phase_origin}.
\end{equation}
By the second assumption, $e^{i\psi(\omega)/2}=-e^{i(\psi(\omega)/2-\Delta\delta)}$, or equivalently, $\psi(\omega)=\pi/2+\Delta\delta/2$ and \cref{eq:beam_splitter_unitary_transform_balanced_phase_origin} becomes
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        e^{i(\phi(\omega)+\Delta\delta/2)} & i
        \\
        i & e^{-i(\phi(\omega)+\Delta\delta/2)}
    \end{pmatrix}
    e^{i\Delta\delta/2}
    \begin{pmatrix}
        \mathcal{E}_1(\omega)
        \\
        \mathcal{E}_2(\omega)
    \end{pmatrix}
    .
\end{equation}
Removing the global phase and choosing the phase reference such that $\phi(\omega)+\Delta\delta=0$ finally yields $U_{50:50}^\text{qo}$.
It should be clear from our initial discussion that the assumption of a symmetric beam splitter is not justified in general for most practical beam splitter designs.
In particular, engineering of control loops to find operating points in modulators comprising beam splitters, for instance, in automatic bias control of \gls{mzm}, requires a throughout analysis of relevant phases in a system.
That said, as long as we are only interested in specific aspects of a system, it is perfectly fine to chose the phases such that the calculation become as simple as possible.

\FloatBarrier
\subsection{Linear passive four-port}

% TODO: cite reference where reflection and transmission properties are measured

In electrical and optical network theory, it is common practice to model devices by their number of in- and outputs while assuming linear operation of the components.
One advantage of such an approach is that one does not need to know the internals of the components at hand.
Another advantage is that the component can be fully characterized by measuring the in- and output scattering parameters.
\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/four-port}
    \caption{Linear optical four-port with input field..}\label{fig:four_port}
\end{figure}
\Cref{fig:four_port} shows a linear optical four-port.
In contrast to our beam splitter model, does the four-port account for backscattering (or back reflection) and we discussed for the practical beam splitters that back reflection indeed occurs for the cubic beam splitter.
For fiber-optical components the scattering parameters are usually specified in the technical datasheet.
Alternatively, an optical network analyzer, see the setup in \Cref{fig:optical_network_analyzer}, is able to determine the scattering parameters.
\begin{figure}[htb]
    \centering
    \includegraphics{figures/pstricks/optical-network-analyzer}
    \caption{Experimental setup of an optical network analyzer measuring the scattering parameters of an optical four-port.}\label{fig:optical_network_analyzer}
\end{figure}
The complex scattering parameters are the elements of the scattering matrix $S(\omega)\in\mathbb{C}^{4\times4}$ which relates the in- and output field amplitudes via
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_{1}^\text{out}(\omega) \\
        \mathcal{E}_{2}^\text{out}(\omega) \\
        \mathcal{E}_{3}^\text{out}(\omega) \\
        \mathcal{E}_{4}^\text{out}(\omega)
    \end{pmatrix}
    =
    \begin{pmatrix}
    	s_{11}(\omega) & s_{12}(\omega) & s_{13}(\omega) & s_{14}(\omega) \\
    	s_{21}(\omega) & s_{22}(\omega) & s_{23}(\omega) & s_{24}(\omega) \\
    	s_{31}(\omega) & s_{32}(\omega) & s_{33}(\omega) & s_{34}(\omega) \\
    	s_{41}(\omega) & s_{42}(\omega) & s_{43}(\omega) & s_{44}(\omega)
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_{1}^\text{in}(\omega) \\
        \mathcal{E}_{2}^\text{in}(\omega) \\
        \mathcal{E}_{3}^\text{in}(\omega) \\
        \mathcal{E}_{4}^\text{in}(\omega)
    \end{pmatrix}
\end{equation}
and accounts for reflection, transmission, cross-talk, and coupling of the ports.
For a passive four-port the energy of the output field amplitudes must be less or equal to the energy of the input field amplitudes and strictly equal for a lossless passive four-port.
Most fiber components are reciprocal~\cite{NBS1981} and the scattering matrix $S(\omega)$ is transpose symmetric.

The beam splitter transformation is the special case
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_{1}^\text{out} \\
        \mathcal{E}_{2}^\text{out} \\
        \mathcal{E}_{3}^\text{out} \\
        \mathcal{E}_{4}^\text{out}
    \end{pmatrix}
    =
    \begin{pmatrix}
    	0 & 0 & 0 & 0 \\
    	0 & 0 & 0 & 0 \\
    	s_{31}(\omega) & s_{32}(\omega) & 0 & 0 \\
    	s_{41}(\omega) & s_{42}(\omega) & 0 & 0
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_{1}^\text{in}(\omega) \\
        \mathcal{E}_{2}^\text{in}(\omega) \\
        \mathcal{E}_{3}^\text{in}(\omega) \\
        \mathcal{E}_{4}^\text{in}(\omega)
    \end{pmatrix}
\end{equation}
with the identifications $\mathcal{E}_i^\text{in}=\mathcal{E}_i,\mathcal{E}_i^\text{out}=\mathcal{E}_i^\prime$ and
\begin{equation}
    \begin{pmatrix}
    	s_{31}(\omega) & s_{32}(\omega) \\
    	s_{41}(\omega) & s_{42}(\omega)
    \end{pmatrix}
    =
    \begin{pmatrix}
    	t(\omega) & r(\omega) \\
    	r(\omega) & t(\omega)
    \end{pmatrix}
    .
\end{equation}
While accounting for back reflection of the mode coupler is almost never considered by physicists, our receiver is optimized for such low light intensities that back reflection of the strong \gls{lo} laser is observed and needs to be removed with an optical isolator. 

\FloatBarrier
\subsection{Fiber-optical coupler}

% - coupled mode theory \cite[p.~359]{Luks2009}
\begin{figure}[htb]
	\centering
	\includestandalone{figures/tikz/fiber-coupler}
	\caption{Two-dimensional model of a fiber-optical coupler.}\label{fig:fiber_coupler}
\end{figure}

\FloatBarrier
\subsection{Quantum mode coupler}

% approaches:
% a) extend concept of unitary transform to annihilation operators
% b) use linear interaction Hamiltonian (Haroche)
% c) use mode-coupling theory

% theoretical models:
% - coupled mode theory \cite[p.~359]{Luks2009}
% - nonclassical fields in a linear coupler \cite{Lai1991}
% - generalized non-linear coupling in \cite{Abdalla2000}
% - macroscopic reflection and transmission using topological Chern-Simons term \cite{Pismak2014}

The mode coupler is a generalization of the beam splitter and is described by the Hamiltonian
\begin{equation}
	\hat{H}
	=
	\hat{H}_0
	+
	\hat{H}_\text{int}(t)
\end{equation}
where we have the Hamiltonian of the scalar Maxwell field
\begin{equation}
	\hat{H}_0
	=
	\int_{\mathbb{R}^3}\frac{\dd[3]{p}}{(2\pi)^3}
	\omega(\vb{p})
	\hat{a}^\dagger(\vb{p})
	\hat{a}(\vb{p})
\end{equation}
and the interaction Hamiltonian
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int\dd[3]{x}
	g(t,\vb{x})
	\hat{A}(t,\vb{x})
	\hat{A}(t,\vb{x})
	.
\end{equation}
We expand the fields into their positive and negative frequency parts and only keep the mixed terms known as the rotating wave approximation~\cite[p.~158]{Gardiner2000}
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int\dd[3]{x}
	g(t,\vb{x})
	\left[
		\hat{A}^{(-)}(t,\vb{x})
		\hat{A}^{(+)}(t,\vb{x})
		+
		\hat{A}^{(+)}(t,\vb{x})
		\hat{A}^{(-)}(t,\vb{x})
	\right]
	.
\end{equation}
The rotating wave approximation is justified when for long time scales relative to the highly oscillating terms.
Additionally, Haroche~\cite[p.~127]{Haroche2006} argues that the high-frequency terms do not conserve energy as two particles are created or destroyed in one process.
However, such processes are, in general, possible in the nonlinear regime~\cite{QuesadaMejia2015}.
Inserting the definition of the positive and negative frequency operators, we find
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
	\hat{a}(\vb{p})
	e^{-i\omega(\vb{p})t}
	g(t,\vb{p}-\vb{q})
	\hat{a}^\dagger(\vb{q})
	e^{+i\omega(\vb{q})t}
	+
	\text{h.c.}
\end{equation}
wherein we used the spatial Fourier transform of the coupling
\begin{equation}
	g(t,\vb{p}-\vb{q})
	=
	\int_{\mathbb{R}^3}\dd[3]{x}
	g(t,\vb{x})
	e^{-i(\vb{p}-\vb{q})\vdot\vb{x}}
	.
\end{equation}
Assuming the mode coupler to be linear and passive, we make the ansatz
\begin{equation}
	g(t,\vb{p}-\vb{q})
	=
	(2\pi)
	\delta^{(1)}\left(\omega(\vb{q})-\omega(\vb{p})\right)
	h\left(t,\omega(\vb{p}),\vu{e}_p,\vu{e}_q\right)
\end{equation}
and reduce the interaction Hamiltonian to
\begin{equation}
	\hat{H}_{ab}
	=
	-
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
	\hat{a}(\vb{p})
	g(t,\vb{p}-\vb{q})
	\hat{a}^\dagger(\vb{q})
	+
	\text{h.c.}
	.
\end{equation}
The time-evolution operator is dominated by the first term of the Magnus expansion
\begin{equation}
	\Omega^{(1)}(t,t_0)
	=
	i
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{q}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\hat{a}(\vb{p})
	\hat{a}^\dagger(\vb{q})
	\int_{t_0}^t
	\dd{t^\prime}
	g(t^\prime,\vb{p}-\vb{q})
	-
	\text{h.c.}
\end{equation}
and the main unitary action of turns out to be
\begin{equation}
	\hat{U}(t,t_0)
	=
	\exp\left\{
		i
		\int_{\mathbb{R}^3}
		\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
		\hat{a}(\vb{p})
		\int_{\mathbb{R}^3}
		\frac{\dd[3]{q}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
		\hat{a}^\dagger(\vb{q})
		\int_{t_0}^t
		\dd{t^\prime}
		g(t^\prime,\vb{p}-\vb{q})
		-
		\text{h.c.}
	\right\}
\end{equation}
which can be considered the field-theoretic time-dependent generalization of the beam splitter action reported in Ref.~\cite{Leonhardt2003,Haroche2006}.

\FloatBarrier
\subsection{Input-output relations for coherent states}