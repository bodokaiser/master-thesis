\section{Optical splitters and couplers}

Optical splitters and couplers are essential for many sophisticated experiments and devices ranging from classical interferometers to experimental realization of quantum NOT gates~\cite{Adami1998}.
An optical coupler superimposes (mixes) two optical fields, an optical splitter divides an input's power among two outputs.
From a physical perspective, the distinction between splitters and couplers is somewhat artificial, and a description using two inputs and two outputs turns out to be strictly necessary.

The present section starts with a discussion of the classical free-ray beam splitter. Employing energy conservation between the complex in- and output field modes leads to a unitary transformation that can be easily extended to the quantum regime as done in the standard quantum optics literature~\cite{Leonhardt2010,Gerry2005,Loudon2000}.
A different approach closely related to network analysis in electrical engineering defines the optical coupler as a linear passive optical four-port and requires no further assumptions.
The measurement of the scattering parameters can fully characterize the linear passive optical four-port.
Finally, using mode-coupling theory~\cite[p.~359]{Luks2009}, we present a more natural quantum model specific to the waveguide coupler.
We close the section with general input-output relations for coherent states to discuss the limiting cases, e.g., the optical splitter.

\subsection{Classical free-ray beam splitters}

The most commonly employed (free-ray) designs of the beam splitter are the cubic, plate, and pellicle beam splitters depicted in \Cref{fig:beam_splitter_types}.
The cubic beam splitter is made of two triangular prisms.
The interface between the two prisms is finished with a dielectric coating.
The outward-facing surface of the prisms is grafted with an \gls{ar} coating.
Compared to the plate and pellicle beam splitter, the cubic beam splitter has the highest loss and aberrations.
Nonetheless, the cubic beam splitter is a popular choice because of its simple integration into an optical setup.
The pellicle beam splitter consists of a few micrometer thin membrane, optionally with a one-sided coating.
The small thickness of the membrane makes the pellicle beam splitter the most performant in terms of absorption and aberrations among the three designs.
Furthermore, the pellicle embodiment of the beam splitter supports a broad wavelength range.
The drawback of using a pellicle beam splitter is that they are highly susceptible to acoustic noise and require a precise angle to the incident beam.
The plate beam splitter is like a thick pellicle beam splitter made of glass.
Compared to the cubic and pellicle beam splitter's performance, the plate beam splitter is in-between concerning absorption, aberrations, and wavelength range.
\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/beam-splitter-types}
    \caption{Cubic (a), plate (b), and pellicle (c) beam splitter.}\label{fig:beam_splitter_types}
\end{figure}
Given two input beams, represented by the electrical field components $E_1(t)$ and $E_2(t)$, a beam splitter gives rise to two output beams, represented by the electrical field components $E_1^\prime(t)$ and $E_2^\prime(t)$.
\Cref{fig:beam_splitter_cube_plate} illustrates how the input and output fields emerge in the cubic and plate beam splitter.
The two input fields $E_1(t),E_2(t)$ are incident to the cubic and plate beam splitter's left and top, while the two output electric fields $E_1^\prime(t),E_2^\prime(t)$ exit the beam splitter at the right and bottom.
\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/beam-splitter-cubic-plate}
    \caption{Cubic (left) and plate beam splitter (right) with two input beams represented by the electrical field components $E_1(t),E_2(t)$ and two output beam represented by the electrical field components $E_1^\prime(t),E_2^\prime(t)$.}\label{fig:beam_splitter_cube_plate}
\end{figure}

Inside the beam splitter the electric field $\vb{E}(t,\vb{x})$ satisfies the inhomogeneous wave equation
\begin{equation}
	\laplacian\vb{E}(t,\vb{x})
	-
	\mu\pdv[2]{t}\vb{E}(t,\vb{x})
	=
	\mu\pdv[2]{t}\vb{P}(t,\vb{x})
\end{equation}
where $\mu$ is the magnetic permeability and $\vb{P}(t,\vb{x})$ is the macroscopic polarization~\cite[p.~86]{Murti2014}.
In frequency space, the components of the macroscopic polarization are~\cite[p.~1070]{Mandel1995}
\begin{equation}
	P_i(\omega)
	=
	\chi^{(1)}_{ij}(\omega)E^j(\omega)
	+
	\chi^{(2)}_{ijk}(\omega,\omega^\prime)E^j(\omega)E^k(\omega^\prime)
	+
	\dots
\end{equation}
where $\chi^{(n)}$ denotes the $n$th-order of the electric susceptibility tensor.
For a useful beam splitter, we want the electric susceptibility to be linear in frequency space suggesting the Fourier amplitudes of the in- and output fields to relate via
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(\omega)
        \\
        \mathcal{E}_2^\prime(\omega)
    \end{pmatrix}
    =
    \begin{pmatrix}
        t(\omega) & r^\prime(\omega)
        \\
        r(\omega) & t^\prime(\omega)
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(\omega)
        \\
        \mathcal{E}_2(\omega)
    \end{pmatrix}
    \label{eq:beam_splitter_transform}
\end{equation}
wherein $r(\omega),r^\prime(\omega)$ and $t(\omega),t^\prime(\omega)$ are complex coefficients.
Setting either one of the input Fourier amplitudes, $\mathcal{E}_1(\omega)$ or $\mathcal{E}_2(\omega)$, to zero and reviewing \Cref{fig:beam_splitter_cube_plate}, suggests $r(\omega),r^\prime(\omega)$ and $t(\omega),t^\prime(\omega)$ to quantify the reflection respective transmission properties of the beam splitter.
The absolute value of the transmission $\abs{t(\omega)},\abs{t^\prime(\omega)}$ and reflection coefficients $\abs{r(\omega)},\abs{r^\prime(\omega)}$ determine the splitting ratio of the input power among the outputs.
The complex phase factor of the reflection and transmission coefficients characterize the phase shifts with which the input fields contribute to the output fields.

The beam splitter including the in- and output fields constitute an isolated system.
Ignoring thermal energy exchange between the electric fields and the beam splitter medium, the sum of the field energies before and after the interaction need to be conserved, i.e.,
\begin{equation}
    \abs{\mathcal{E}_1^\prime(\omega)}^2
    +
    \abs{\mathcal{E}_2^\prime(\omega)}^2
    =
    \abs{\mathcal{E}_1(\omega)}^2
    +
    \abs{\mathcal{E}_2(\omega)}^2
    \label{eq:beam_splitter_energy_conservation}
    .
\end{equation}
Inserting \cref{eq:beam_splitter_transform} into \cref{eq:beam_splitter_energy_conservation} and setting the one of the input fields to zero, constraints the coefficients by
\begin{align}
    \abs{r(\omega)}^2+\abs{t(\omega)}^2
    =
    1,
    &&
    \abs{r^\prime(\omega)}^2+\abs{t^\prime(\omega)}^2
    =
    1
    \label{eq:beam_splitter_coefficients_constraint}
    .
\end{align}
Theorists often claim the transformation in \cref{eq:beam_splitter_transform} to be symmetric (or reciprocal) due to Maxwell's equations~\cite[p.~129]{Haroche2006}.
However, according Ref.~\cite{Potton2004} only optical system with a single dielectric layer are reciprocal but most physical beam splitters comprise multiple dielectric layers.\footnote{For example, cubic beam splitters have a coating followed by optical cement between the prisms breaking reciprocal symmetry of the system.}

Using classical wave optics and perfect knowledge of the dimensions and material properties, it is possible to derive exact expressions of the complex reflection $r(\omega),r^\prime(\omega)$ and transmission coefficients $t(\omega),t^\prime(\omega)$.
For example, HÃ©nault~\cite{Henault2015} derived an exact expression for the reflected and transmitted amplitudes of a plate beam splitter with one input and a single dielectric layer.
Likewise, Hamilton~\cite{Hamilton2000} discusses the cubic beam splitter with two inputs and different coatings.
In general, the complex reflection and transmission coefficients need to account for multiple reflections at different dielectric layers inside the beam splitter.

\FloatBarrier
\subsection{Unitary transformation between quantum modes}

We define an ideal beam splitter as a linear passive optical four-port that is
\begin{enumerate}
    \item lossless (the energy of the input fields is equal to the energy of the output fields), and
    \item independent of frequency (for the frequency range of the input fields).
\end{enumerate}
In this case, the transformation relating the output with the input fields is unitary.\footnote{Unitary transformations preserve the inner product and $\abs{\mathcal{E}_1}^2+\abs{\mathcal{E}_2}^2=\abs{\mathcal{E}^\prime_1}^2+\abs{\mathcal{E}^\prime_2}^2$ is the norm of the input and output vectors induced by the inner product. As a consequence, a unitary transform $\hat{U}$ satisfies $\hat{U}^{-1}=\hat{U}^\dagger$.}
In general, the unitary transformation describing a lossless beam splitter has four \gls{dof}.\footnote{The beam splitter is described by a linear map $\hat{U}\colon\mathbb{C}^2\to\mathbb{C}^2$ which has eight \gls{dof}. $\hat{U}\hat{U}^\dagger=\mathbb{1}$ removes four \gls{dof}.}
Different parametrizations towards a two-dimensional unitary transformation exist.
In the previous section, we used a parametrization, \cref{eq:beam_splitter_coefficients_transform}, based on the polar representation of the complex reflection and transmission coefficients.
Alternatively, a parametrization involving the Pauli matrices is used in the literature, see, for instance, Ref.~\cite{Zeilinger1981}.
In the following, we use a parametrization introduced by Leonhardt~\cite[p.~92]{Leonhardt2010}
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        e^{+i\Phi} & 0
        \\
        0 & e^{-i\Phi}
    \end{pmatrix}
    \begin{pmatrix}
        \cos\Theta & \sin\Theta
        \\
        -\sin\Theta & \cos\Theta
    \end{pmatrix}
    \begin{pmatrix}
        e^{+i\Psi} & 0
        \\
        0 & e^{-i\Psi}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform}
\end{equation}
parametrized by the angles $\Lambda,\Theta,\Psi,\Phi\in\mathbb{R}$.
The parametrization of \cref{eq:beam_splitter_unitary_transform} allows for a physical interpretation without assumptions of a physical model.
More precisely, the matrix product in \cref{eq:beam_splitter_unitary_transform} reads as the composition of a phase transform of $\pm\Psi$ applied to the input fields, a mixing of the input fields with angle $\Theta$, and a phase transform of $\pm\Phi$ applied to the mixed fields, in addition, the output fields pick up a global phase $\Lambda$ from the optical path length common to the beams.\footnote{Even the global phase $\Lambda$ becomes local, and thereby measurable, if we consider the beam splitter to be only part of a subsystem, see \cref{sec:mach_zehnder_modulator}.}

If we carry out the matrix multiplication in \cref{eq:beam_splitter_unitary_transform}, we find
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        e^{i(+\Phi+\Psi)}\cos\Theta & e^{i(+\Phi-\Psi)}\sin\Theta
        \\
        -e^{i(-\Psi+\Phi)}\sin\Theta & e^{i(-\Psi-\Phi)}\cos\Theta
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix},
\end{equation}
we introduce $\phi=(\Phi+\Psi)/2,\psi=(\Phi-\Psi)/2$ and write
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        e^{+i\psi/2}\cos\Theta & e^{i\phi/2}\sin\Theta
        \\
        e^{-i\phi/2+i\pi}\sin\Theta & e^{-i\psi/2}\cos\Theta
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_expanded}.
\end{equation}
For $\Theta=0$ and $\Theta=\pi/2$ there is no mixing, yet, there is a subtle difference between these cases.
In the case of $\Theta=0$, \cref{eq:beam_splitter_unitary_transform_expanded} becomes
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        e^{+i\psi/2} & 0
        \\
        0 & e^{-i\psi/2}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        \mathcal{E}_1(t)e^{+i\psi/2}
        \\
        \mathcal{E}_2(t)e^{-i\psi/2}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_transmission},
\end{equation}
in other words, an additional phase difference of $\psi$ is added between the output fields.
In the case of $\Theta=\pi/2$, \cref{eq:beam_splitter_unitary_transform_expanded} becomes
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        0 & e^{+i\phi/2}
        \\
        e^{-i\psi/2+i\pi} & 0
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    =
    e^{i\Lambda}
    \begin{pmatrix}
        \mathcal{E}_2(t)e^{+i\phi/2}
        \\
        \mathcal{E}_1(t)e^{-i\phi/2+i\pi}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_reflection},
\end{equation}
and a phase difference of $\pi-\phi$ is added between the output fields.
The difference between these two phase shifts between the output fields yields $\phi+\psi=\pi$.
If we identify $\Theta=0$ with the transmitted and $\Theta=\pi/2$ with the reflected field\footnote{Only the physical models have a notion of reflectance and transmittance. For the unitary transformation there is no fundamental difference between $\Theta=0,\pi/2$ as the $\pi$ phase can be moved around by reparamtrization.}, we recover the statement~\cite{Zeilinger1981} that the phase shift between the transmitted and reflected fields of an ideal beam splitter adds up to $\pi$.\footnote{The statement should not be confused with the statement that the phase difference between the output fields are phase-shifted by $\pi$.}

Evidently, the phases $\psi,\phi$ are a source of confusion and require a thorough examination.
For simplicity, we assume a balanced lossless beam splitter which distributes the input power equally among the outputs.
The corresponding transformation is obtained by setting $\Theta=\pi/4$ in \cref{eq:beam_splitter_unitary_transform}
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    \frac{e^{i\Lambda}}{\sqrt{2}}
    \begin{pmatrix}
        e^{i\phi} & e^{i\psi}
        \\
        -e^{-i\psi} & e^{-i\phi}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    =
    \frac{e^{i\Lambda}}{\sqrt{2}}
    \begin{pmatrix}
        \mathcal{E}_1(t)e^{i\phi}+\mathcal{E}_2(t)e^{i\psi}
        \\
        \mathcal{E}_1(t)e^{-i\psi+i\pi}+\mathcal{E}_2(t)e^{-i\phi}
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced}.
\end{equation}
\Cref{eq:beam_splitter_unitary_transform_balanced} cannot be simplified without further assumptions\footnote{In principle, the dimensions, materials and coatings of a physical beam splitter can be chosen such that $\psi,\phi,\Lambda$ can take arbitrary values.}.
In the quantum optics literature, for instance, Ref.~\cite[p.~138]{Gerry2005}, we frequently find the claim that
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & i\\
        i & 1
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced_qo}
\end{equation}
describes an ideal balanced beam splitter.
Moreover, the quantum communication literature, for example, Ref.~\cite{Shapiro2009}, uses
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & -1\\
        1 & 1
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced_qc},
\end{equation}
which has the merit that we can write $\mathcal{E}_\pm(t)=\left(\mathcal{E}_1(t)\pm\mathcal{E}_2(t)\right)/\sqrt{2}$, as the transformation of an ideal balanced beam splitter.
While \cref{eq:beam_splitter_unitary_transform_balanced_qo} corresponds to $\Lambda=0,\psi=0,\phi=\pi/2$ in \cref{eq:beam_splitter_unitary_transform_balanced}, and \cref{eq:beam_splitter_unitary_transform_balanced_qc} can be obtained with $\Lambda=0,\phi=0,\psi=\pi$, we rarely find a justification to remove three physical \gls{dof}.
If we assume an ideal beam splitter to be
\begin{enumerate}
    \item no other fields except for the input fields to be in the system, and
    \item symmetric with respect to the input fields,
\end{enumerate}
it is possible to derive \cref{eq:beam_splitter_unitary_transform_balanced_qo} from \cref{eq:beam_splitter_unitary_transform_balanced}.
The first assumption lets us remove two \gls{dof}: first, $\Lambda$ is a global phase that cannot be measured, and we are free to choose $\Lambda$ as convenient, second, we are allowed to choose a common phase origin.
Let us explicitly write $\mathcal{E}_1(t)e^{i\delta_1}$ and $\mathcal{E}_2(t)e^{i\delta_2}$.
By adjusting the global phase $\Lambda$ accordingly, this is equivalent to $\mathcal{E}_1(t)e^{i\Delta\delta}$ and $\mathcal{E}_2(t)$ wherein $\Delta\delta=\delta_1-\delta_2$, and we can rewrite \cref{eq:beam_splitter_unitary_transform_balanced} as
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        e^{i(\phi/2+\Delta\theta)} & e^{i\psi/2}
        \\
        -e^{-i(\psi/2-\Delta\theta)} & e^{-i\phi/2}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    \label{eq:beam_splitter_unitary_transform_balanced_phase_origin}.
\end{equation}
By the second assumption, $e^{i\psi/2}=-e^{i(\psi/2-\Delta\delta)}$, or equivalently, $\psi=\pi/2+\Delta\delta/2$ and \cref{eq:beam_splitter_unitary_transform_balanced_phase_origin} becomes
\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_1^\prime(t)
        \\
        \mathcal{E}_2^\prime(t)
    \end{pmatrix}
    =
    \frac{e^{i\Delta\delta/2}}{\sqrt{2}}
    \begin{pmatrix}
        e^{i(\phi+\Delta\delta/2)} & i
        \\
        i & e^{-i(\phi+\Delta\delta/2)}
    \end{pmatrix}
    \begin{pmatrix}
        \mathcal{E}_1(t)
        \\
        \mathcal{E}_2(t)
    \end{pmatrix}
    .
\end{equation}
Removing the global phase and choosing the phase reference such that $\phi+\Delta\delta=0$ finally yields \cref{eq:beam_splitter_unitary_transform_balanced_qo}.
The assumption of a symmetric beam splitter is not justified for most physical beam splitters\footnote{See the discussion of physcial beam splitter types in \cref{sec:beam_splitter}.}.
Furthermore, the requirement that the optical system comprises only two beams massively restricts the use of \cref{eq:beam_splitter_unitary_transform_balanced_qo}.
That said, the assumptions of our ideal beam splitter are already very strong and in contrast to \cref{eq:beam_splitter_unitary_transform_balanced}, \cref{eq:beam_splitter_unitary_transform_balanced_qo} and \cref{eq:beam_splitter_unitary_transform_balanced_qc} allow simple calculations.

\FloatBarrier
\subsection{Linear passive four-port}
% TODO: cite reference where reflection and transmission properties are measured\begin{figure}[htb]
    \centering
    \includestandalone{figures/tikz/four-port}
    \caption{In- and outputs of a beam splitter used for the scattering parameter model.}\label{fig:beam_splitter_scattering_parameters}
\end{figure}

\begin{equation}
    \begin{pmatrix}
        \mathcal{E}_{1,\text{out}} \\
        \mathcal{E}_{2,\text{out}} \\
        \mathcal{E}_{3,\text{out}} \\
        \mathcal{E}_{4,\text{out}}
    \end{pmatrix}
    =
    T
    \begin{pmatrix}
        \mathcal{E}_{1,\text{in}} \\
        \mathcal{E}_{2,\text{in}} \\
        \mathcal{E}_{3,\text{in}} \\
        \mathcal{E}_{4,\text{in}}
    \end{pmatrix}
\end{equation}
where $T\in\mathbb{C}^{4\times4}$.

\begin{figure}[htb]
    \centering
    \includegraphics{figures/pstricks/optical-network-analyzer}
    \caption{Experimental setup of an optical network analyzer measuring the scattering parameters of a real beam splitter.}\label{fig:beam_splitter_network_analyzer}
\end{figure}

\FloatBarrier
\subsection{Quantum mode coupler}

% theoretical models:
% - coupled mode theory \cite[p.~359]{Luks2009}
% - nonclassical fields in a linear coupler \cite{Lai1991}
% - generalized non-linear coupling in \cite{Abdalla2000}
% - macroscopic reflection and transmission using topological Chern-Simons term \cite{Pismak2014}
\begin{figure}[htb]
	\centering
	\includestandalone{figures/tikz/fiber-coupler}
	\caption{Two-dimensional model of a fiber-optical coupler.}\label{fig:fiber_coupler}
\end{figure}

The mode coupler is a generalization of the beam splitter and is described by the Hamiltonian
\begin{equation}
	\hat{H}
	=
	\hat{H}_0
	+
	\hat{H}_\text{int}(t)
\end{equation}
where we have the Hamiltonian of the scalar Maxwell field
\begin{equation}
	\hat{H}_0
	=
	\int_{\mathbb{R}^3}\frac{\dd[3]{p}}{(2\pi)^3}
	\omega(\vb{p})
	\hat{a}^\dagger(\vb{p})
	\hat{a}(\vb{p})
\end{equation}
and the interaction Hamiltonian
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int\dd[3]{x}
	g(t,\vb{x})
	\hat{A}(t,\vb{x})
	\hat{A}(t,\vb{x})
	.
\end{equation}
We expand the fields into their positive and negative frequency parts and only keep the mixed terms known as the rotating wave approximation~\cite[p.~158]{Gardiner2000}
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int\dd[3]{x}
	g(t,\vb{x})
	\left[
		\hat{A}^{(-)}(t,\vb{x})
		\hat{A}^{(+)}(t,\vb{x})
		+
		\hat{A}^{(+)}(t,\vb{x})
		\hat{A}^{(-)}(t,\vb{x})
	\right]
	.
\end{equation}
The rotating wave approximation is justified when for long time scales relative to the highly oscillating terms.
Additionally, Haroche~\cite[p.~127]{Haroche2006} argues that the high-frequency terms do not conserve energy as two particles are created or destroyed in one process.
However, such processes are, in general, possible in the nonlinear regime~\cite{QuesadaMejia2015}.
Inserting the definition of the positive and negative frequency operators, we find
\begin{equation}
	\hat{H}_\text{int}(t)
	=
	-
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
	\hat{a}(\vb{p})
	e^{-i\omega(\vb{p})t}
	g(t,\vb{p}-\vb{q})
	\hat{a}^\dagger(\vb{q})
	e^{+i\omega(\vb{q})t}
	+
	\text{h.c.}
\end{equation}
wherein we used the spatial Fourier transform of the coupling
\begin{equation}
	g(t,\vb{p}-\vb{q})
	=
	\int_{\mathbb{R}^3}\dd[3]{x}
	g(t,\vb{x})
	e^{-i(\vb{p}-\vb{q})\vdot\vb{x}}
	.
\end{equation}
Assuming the mode coupler to be linear and passive, we make the ansatz
\begin{equation}
	g(t,\vb{p}-\vb{q})
	=
	(2\pi)
	\delta^{(1)}\left(\omega(\vb{q})-\omega(\vb{p})\right)
	h\left(t,\omega(\vb{p}),\vu{e}_p,\vu{e}_q\right)
\end{equation}
and reduce the interaction Hamiltonian to
\begin{equation}
	\hat{H}_{ab}
	=
	-
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
	\hat{a}(\vb{p})
	g(t,\vb{p}-\vb{q})
	\hat{a}^\dagger(\vb{q})
	+
	\text{h.c.}
	.
\end{equation}
The time-evolution operator is dominated by the first term of the Magnus expansion
\begin{equation}
	\Omega^{(1)}(t,t_0)
	=
	i
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\int_{\mathbb{R}^3}
	\frac{\dd[3]{q}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
	\hat{a}(\vb{p})
	\hat{a}^\dagger(\vb{q})
	\int_{t_0}^t
	\dd{t^\prime}
	g(t^\prime,\vb{p}-\vb{q})
	-
	\text{h.c.}
\end{equation}
and the main unitary action of turns out to be
\begin{equation}
	\hat{U}(t,t_0)
	=
	\exp\left\{
		i
		\int_{\mathbb{R}^3}
		\frac{\dd[3]{p}}{(2\pi)^3\sqrt{2\omega(\vb{p})}}
		\hat{a}(\vb{p})
		\int_{\mathbb{R}^3}
		\frac{\dd[3]{q}}{(2\pi)^3\sqrt{2\omega(\vb{q})}}
		\hat{a}^\dagger(\vb{q})
		\int_{t_0}^t
		\dd{t^\prime}
		g(t^\prime,\vb{p}-\vb{q})
		-
		\text{h.c.}
	\right\}
\end{equation}
which can be considered the field-theoretic time-dependent generalization of the beam splitter action reported in Ref.~\cite{Leonhardt2003,Haroche2006}.

\FloatBarrier
\subsection{Input-output relations for coherent state}